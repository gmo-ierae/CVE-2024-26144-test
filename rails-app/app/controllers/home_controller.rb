require 'stringio'

class HomeController < ApplicationController
  def login
    session[:username] = 'admin'

    render json: {}
  end

  # ロゴファイルを作成して、Active Storageのproxy URLへリダイレクトする
  def logo
    key = 'logo'
    blob = ActiveStorage::Blob.find_by_key(key)
    if blob.nil?
      io = StringIO.new
      io.puts('hello')
      io.rewind

      blob = ActiveStorage::Blob.create_and_upload!(key: key, io: io, filename: 'logo.png')
    end

    logo_path = Rails.application.routes.url_helpers.rails_storage_proxy_path(blob, only_path: true)
    redirect_to logo_path
  end
end
